<?xml version="1.0" encoding="UTF-8"?>

<!--
  Modified version of original InstallDirDlg.wxs from Wix 3.5.
  This one uses modified InstallDirDlg with new checkboxes for 
  selecting Everyone/Just me.
-->

<!--
   Copyright (c) Microsoft Corporation.  All rights reserved.
   
   The use and distribution terms for this software are covered by the
   Common Public License 1.0 (http://opensource.org/licenses/cpl1.0.php)
   which can be found in the file CPL.TXT at the root of this distribution.
   By using this software in any fashion, you are agreeing to be bound by
   the terms of this license.
   
   You must not remove this notice, or any other, from this software.
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Fragment>

    <!-- cur or all -->
    <Property Id="EVERYONE_JUSTME">cur</Property>
    <SetProperty Id="EVERYONE_JUSTME" Before="CostFinalize" Value="all">
      ALLUSERS = "1"
    </SetProperty>

    <UI>
      <Dialog Id="InstallDirDlgEx" Width="370" Height="270" Title="!(loc.InstallDirDlg_Title)">
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" />
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>

        <Control Id="Description" Type="Text" X="25" Y="23" Width="280" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.InstallDirDlgDescription)" />
        <Control Id="Title" Type="Text" X="15" Y="6" Width="200" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.InstallDirDlgTitle)" />
        <Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="!(loc.InstallDirDlgBannerBitmap)" />
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />

        <Control Id="FolderLabel" Type="Text" X="20" Y="60" Width="290" Height="30" NoPrefix="yes" Text="!(loc.InstallDirDlgFolderLabel)" />
        <Control Id="Folder" Type="PathEdit" X="20" Y="100" Width="320" Height="18" Property="WIXUI_INSTALLDIR" Indirect="yes" />
        <Control Id="ChangeFolder" Type="PushButton" X="20" Y="120" Width="56" Height="17" Text="!(loc.InstallDirDlgChange)" />
        
        <!--Everyone/Just me-->
        <Control Id="AllOrMeLabel" Type="Text" X="20" Y="160" Width="330" Height="20"
                   Text="!(loc.InstallDirDlgAllOrMe)">
          <Condition Action="disable">PREVIOUS_VERSION_DETECTED</Condition>
        </Control>
        <Control Id="UserSelection" Type="RadioButtonGroup"
                  X="26" Y="180" Width="305" Height="45" Property="EVERYONE_JUSTME"
                  Text="EVERYONE_JUSTME">
          <RadioButtonGroup Property="EVERYONE_JUSTME">
            <RadioButton Value="cur" X="0" Y="0" Width="295" Height="16"
                       Text="!(loc.InstallDirDlgJustMe)" />
            <RadioButton Value="all" X="0" Y="20" Width="295" Height="16"
                       Text="!(loc.InstallDirDlgEveryone)" />
          </RadioButtonGroup>
          <Condition Action="disable">PREVIOUS_VERSION_DETECTED</Condition>
        </Control>

      </Dialog>

      <!--Set ALLUSERS according to radio buttons-->
      <!-- set null value -->
      <Publish Dialog="InstallDirDlgEx" Control="Next" Order="2"
               Property="ALLUSERS" Value="{}">EVERYONE_JUSTME = "cur"</Publish>
      <Publish Dialog="InstallDirDlgEx" Control="Next" Order="4"
               Property="ALLUSERS" Value="1">EVERYONE_JUSTME = "all"</Publish>
    </UI>
  </Fragment>
</Wix>